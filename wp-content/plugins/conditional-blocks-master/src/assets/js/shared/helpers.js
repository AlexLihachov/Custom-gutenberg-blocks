/* global moment */

export function conblockSVG() {
	return ( <svg className="conditional-blocks-svg" width="20" height="20" viewBox="0 0 92 101" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M42.0652 65.3798V30.9627C42.0652 28.8518 40.3558 27.1387 38.2412 27.1387H3.82406C1.70938 27.1387 0 28.8518 0 30.9627V65.3798C0 67.4907 1.70938 69.2039 3.82406 69.2039H38.2412C40.3558 69.2039 42.0652 67.4907 42.0652 65.3798ZM22.9446 57.7315H15.2962C13.1816 57.7315 11.4722 56.0184 11.4722 53.9075C11.4722 51.7965 13.1816 50.0834 15.2962 50.0834H22.9446C25.0592 50.0834 26.7686 51.7965 26.7686 53.9075C26.7686 56.0184 25.0592 57.7315 22.9446 57.7315ZM26.7686 46.2592H15.2962C13.1816 46.2592 11.4722 44.546 11.4722 42.4351C11.4722 40.3242 13.1816 38.611 15.2962 38.611H26.7686C28.8833 38.611 30.5927 40.3242 30.5927 42.4351C30.5927 44.546 28.8835 46.2592 26.7686 46.2592Z" fill="#686868" />
		<path d="M25.9755 19.7438C34.0125 11.9661 52.1326 10.5562 63.7467 15.5014L62.4706 15.9282C60.2782 16.6603 59.0943 19.0284 59.8264 21.2207C60.4078 22.9738 62.0395 24.0825 63.7926 24.0825C64.2319 24.0825 64.6753 24.0113 65.1146 23.865L74.595 20.7061C74.6411 20.6895 74.6744 20.6518 74.7205 20.6349C74.9674 20.543 75.1765 20.3798 75.4067 20.2374C75.6619 20.0827 75.9254 19.9487 76.1347 19.7479C76.1724 19.7144 76.2184 19.7018 76.2561 19.6685C76.3983 19.522 76.4569 19.338 76.574 19.1749C76.7538 18.9323 76.938 18.7063 77.0635 18.4302C77.1765 18.1792 77.2182 17.9156 77.2769 17.652C77.3355 17.3926 77.4108 17.15 77.4191 16.8864C77.4316 16.5767 77.3647 16.2839 77.3102 15.9786C77.2726 15.7903 77.3018 15.602 77.239 15.4138L73.0553 2.8624C72.3232 0.67003 69.9802 -0.518036 67.7627 0.21818C65.5747 0.94616 64.3905 3.31837 65.1185 5.51074L65.7169 7.29303C51.0406 1.61138 30.494 3.72825 20.1558 13.7317C18.499 15.3341 18.4529 17.9866 20.0595 19.6475C21.6704 21.3045 24.3146 21.3547 25.9755 19.7438Z" fill="#555D66" />
		<path d="M70.3632 80.6702C62.3263 88.4479 44.2062 89.8578 32.5921 84.9125L36.9433 83.4607C39.1313 82.7327 40.3155 80.3605 39.5875 78.1681C38.8554 75.9801 36.504 74.7877 34.2949 75.5239L21.7436 79.7076C21.6934 79.7243 21.6641 79.762 21.618 79.7788C21.3545 79.8751 21.1327 80.0465 20.8901 80.1971C20.6516 80.3478 20.4047 80.4733 20.2039 80.6657C20.1662 80.6992 20.1201 80.7074 20.0825 80.7451C19.9403 80.8916 19.8816 81.0755 19.7646 81.2387C19.5847 81.4813 19.4006 81.7072 19.2751 81.9834C19.1621 82.2344 19.1203 82.498 19.0617 82.7615C19.003 83.0167 18.9277 83.2595 18.9195 83.5272C18.907 83.8368 18.9738 84.1296 19.0283 84.435C19.066 84.6233 19.0368 84.8115 19.0995 84.9998L23.2833 97.5512C23.8691 99.3042 25.4964 100.413 27.2495 100.413C27.6888 100.413 28.1322 100.346 28.5758 100.195C30.7639 99.4674 31.948 97.0952 31.22 94.9028L30.6217 93.1205C35.9435 95.179 42.0099 96.2458 48.1099 96.2458C58.8372 96.2458 69.5894 93.0578 76.1832 86.6817C77.8399 85.0792 77.886 82.4268 76.2794 80.7659C74.6725 79.1097 72.0285 79.0636 70.3632 80.6702Z" fill="#555D66" />
		<path d="M88.9108 36.2983H61.7102C60.039 36.2983 58.688 37.6523 58.688 39.3206V66.5212C58.688 68.1895 60.039 69.5434 61.7102 69.5434H88.9108C90.5821 69.5434 91.9331 68.1895 91.9331 66.5212V39.3206C91.9331 37.6523 90.5821 36.2983 88.9108 36.2983ZM76.8216 60.4766H70.777C69.1057 60.4766 67.7547 59.1226 67.7547 57.4543C67.7547 55.786 69.1057 54.4321 70.777 54.4321H76.8216C78.4929 54.4321 79.8438 55.786 79.8438 57.4543C79.8438 59.1226 78.493 60.4766 76.8216 60.4766ZM79.844 51.4097H70.7771C69.1058 51.4097 67.7549 50.0558 67.7549 48.3875C67.7549 46.7191 69.1058 45.3652 70.7771 45.3652H79.844C81.5152 45.3652 82.8662 46.7191 82.8662 48.3875C82.8662 50.0558 81.5152 51.4097 79.844 51.4097Z" fill="#878787" />
	</svg>
	);
}
/**
 * Updates the Conditons attribute object.
 *
 * @param {string} key key name of the value to update e.g 'hideOnMobile'.
 * @param props
 * @param {mixed} value Pass value only for strings.
 */
export function updateAttribute( props, key, value = null ) {
	const {
		attributes,
		setAttributes,
	} = props;

	// Create a copy of the attributes
	const tempAttribues = Object.assign( {}, attributes );

	const conditionsReady = conblockCheckObject( () => tempAttribues.conditionalBlocksAttributes );

	if ( ! conditionsReady ) {
		return;
	}

	// Grab the exsiting object.
	const updatedCondition = {
		...tempAttribues.conditionalBlocksAttributes,
	};

	if ( typeof key === 'string' ) {
		const nestedKey = key.split( '.' );
		// if nested e.g 'postMeta.key'.

		if ( nestedKey[ 1 ] ) {
			// if nested key isn't set, then make it an object. this is used for post 'postMeta.key' after upgrading to pro.
			if ( ! updatedCondition[ nestedKey[ 0 ] ] ) {
				updatedCondition[ nestedKey[ 0 ] ] = {}; // empty object
			}

			// Set the value.
			updatedCondition[ nestedKey[ 0 ] ][ nestedKey[ 1 ] ] = value;
		} else {
			updatedCondition[ key ] = value;
		}
	}

	// Update the Object
	setAttributes( {
		conditionalBlocksAttributes: updatedCondition,
	} );
}

/**
 * Delete a conditional date by the key.
 *
 * @param {Object} props Block props.
 * @param {string} key of the item in the array.
 */
export function addDateCondition( props, key ) {
	const {
		attributes,
		setAttributes,
	} = props;

	// Create a copy of the attributes
	const tempAttribues = Object.assign( {}, attributes );

	const conditionsReady = conblockCheckObject( () => tempAttribues.conditionalBlocksAttributes );

	if ( ! conditionsReady ) {
		return;
	}

	// Grab the exsiting object.
	const updatedCondition = {
		...tempAttribues.conditionalBlocksAttributes,
	};

	if ( moment ) {
		const newDate = moment.tz( 'WP' ).unix();

		if ( typeof key === 'string' ) {
			const defaultValue = { id: newDate, start: newDate, end: newDate };
			updatedCondition[ key ].push( defaultValue );
		}
	}

	// Update the Object
	setAttributes( {
		conditionalBlocksAttributes: updatedCondition,
	} );
}

/**
 * Update a conditional date attribute.
 *
 * @param {Object} props Block props.
 * @param {string} key of the item in the array.
 * @param {string} dateType name of key to update, either 'start' or 'end' or 'show24HourFromat'.
 * @param {string} dateValue new date.
 */
export function updateDate( props, key, dateType, dateValue ) {
	const {
		attributes,
		setAttributes,
	} = props;

	// Create a copy of the attributes
	const tempAttribues = Object.assign( {}, attributes );

	const conditionsReady = conblockCheckObject( () => tempAttribues.conditionalBlocksAttributes );

	if ( ! conditionsReady ) {
		return;
	}

	// Grab the exsiting object.
	const updatedCondition = {
		...tempAttribues.conditionalBlocksAttributes,
	};

	if ( updatedCondition.dates && updatedCondition.dates[ key ] ) {
		// Set the new date
		if ( updatedCondition.dates[ key ] ) {
			if( dateType == 'start' || dateType == 'end' ) {
				const newDate = dateValue ? moment.tz( dateValue, 'WP' ).unix() : null;
				updatedCondition.dates[ key ][ dateType ] = newDate;
			} else {
				// Save values other than date i.e. 'start' or 'end'
				updatedCondition.dates[ key ][ dateType ] = dateValue;
			}
		}
	}

	// Update the Object
	setAttributes( {
		conditionalBlocksAttributes: updatedCondition,
	} );
}

/**
 * Delete a conditional date by the key.
 *
 * @param {Object} props Block props.
 * @param {string} key of the item in the array.
 */
export function deleteDate( props, key ) {
	const {
		attributes,
		setAttributes,
	} = props;

	// Create a copy of the attributes
	const tempAttribues = Object.assign( {}, attributes );

	const conditionsReady = conblockCheckObject( () => tempAttribues.conditionalBlocksAttributes );

	if ( ! conditionsReady ) {
		return;
	}

	// Grab the exsiting object.
	const updatedCondition = {
		...tempAttribues.conditionalBlocksAttributes,
	};

	if ( updatedCondition.dates ) {
		// Delete the array entry by key.
		updatedCondition.dates.splice( key, 1 );
	}

	// Update the Object
	setAttributes( {
		conditionalBlocksAttributes: updatedCondition,
	} );
}

/**
 * Check if object is ready.
 *
 * @param {Object} fn object function to check.
 * @param {mixed} defaultVal Default to return if unsuccessful.
 *
 * @return either.
 */

export function conblockCheckObject( fn, defaultVal ) {
	try {
		return fn();
	} catch ( e ) {
		return defaultVal;
	}
}

/**
 * Try Catch Value
 *
 * @param {string} value to check.
 * @param {mixed} defaultVal Defualt if unsuccessful.
 *
 * @return {mixed} either.
 */
export function conblockGetValue( value, defaultVal ) {
	try {
		return value;
	} catch ( e ) {
		return defaultVal;
	}
}
